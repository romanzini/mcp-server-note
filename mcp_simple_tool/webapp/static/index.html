<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"/><title>Notes Chat</title><meta name="viewport" content="width=device-width,initial-scale=1"/><style>:root{--bg:#0f1115;--panel:#1b1f27;--accent:#3b82f6;--text:#f1f5f9}body{margin:0;font-family:system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}header{padding:12px 20px;background:var(--panel);display:flex;gap:12px;align-items:center}header h1{font-size:18px;margin:0;font-weight:600}#container{display:flex;height:calc(100vh - 56px)}#chat{flex:1;display:flex;flex-direction:column}#messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:14px}.msg{padding:10px 12px;border-radius:8px;max-width:850px;white-space:pre-wrap;line-height:1.4}.user{background:#2563eb;align-self:flex-end}.assistant{background:var(--panel);border:1px solid #2c333f}.actions{margin-top:8px;background:#11151c;padding:6px 8px;border-radius:6px;font-size:12px}form{display:flex;gap:10px;padding:10px 14px;background:var(--panel)}textarea{flex:1;resize:none;background:#11151c;color:var(--text);border:1px solid #2c333f;border-radius:6px;padding:8px;font-size:14px;height:70px}button{background:var(--accent);color:#fff;border:none;padding:10px 18px;border-radius:6px;font-weight:600;cursor:pointer}button:disabled{opacity:.6;cursor:not-allowed}#status{font-size:12px;opacity:.7;margin-left:auto}.badge{display:inline-block;background:#334155;padding:2px 6px;margin-right:4px;border-radius:4px;font-size:11px}footer{text-align:center;font-size:11px;padding:6px;opacity:.5}</style></head><body><header><h1>Notes Chat</h1><div id="status"></div></header><div id="container"><div id="chat"><div id="messages"></div><form id="chat-form"><textarea id="input" placeholder="Digite sua mensagem..." required></textarea><button type="submit">Enviar</button></form><footer>Interface simples | OpenRouter + Supabase | Sessão local</footer></div></div><script>const input=document.getElementById('input');const form=document.getElementById('chat-form');const messages=document.getElementById('messages');const statusEl=document.getElementById('status');let sessionId=localStorage.getItem('notes_session_id')||null;function setStatus(t){statusEl.textContent=t||''}function escapeHtml(str){return str.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]))}function truncate(s,n=140){if(s.length>n)return s.slice(0,n)+'…';return s}function append(role,text,actions){const div=document.createElement('div');div.className='msg '+role;div.innerHTML=`<div>${escapeHtml(text)}</div>`;if(actions&&actions.length){const aDiv=document.createElement('div');aDiv.className='actions';aDiv.innerHTML=`<strong>Ações (${actions.length})</strong><br>`+actions.map(a=>`<div><span class='badge'>${a.tool}</span><code style='font-size:11px'>${escapeHtml(JSON.stringify(a.args))}</code>${a.result?' ➜ '+escapeHtml(truncate(JSON.stringify(a.result))):''}</div>`).join('');div.appendChild(aDiv)}messages.appendChild(div);messages.scrollTop=messages.scrollHeight}form.addEventListener('submit',async e=>{e.preventDefault();const text=input.value.trim();if(!text)return;append('user',text);input.value='';form.querySelector('button').disabled=true;setStatus('Enviando...');try{const r=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:text,session_id:sessionId})});if(!r.ok){const err=await r.json().catch(()=>({detail:r.statusText}));throw new Error(err.detail||'Erro')}const data=await r.json();sessionId=data.session_id;localStorage.setItem('notes_session_id',sessionId);append('assistant',data.response.text,data.response.actions);setStatus(data.response.synthesized?'Síntese final':'Resposta direta')}catch(err){append('assistant','Erro: '+err.message);setStatus('Erro')}finally{form.querySelector('button').disabled=false}});async function loadHistory(){if(!sessionId)return;try{const r=await fetch('/api/history?session_id='+sessionId);if(!r.ok)return;const data=await r.json();messages.innerHTML='';data.messages.forEach(m=>append(m.role,m.text,m.actions))}catch(e){}}loadHistory();</script></body></html>
